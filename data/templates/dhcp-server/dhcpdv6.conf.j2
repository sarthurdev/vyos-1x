### Autogenerated by dhcpv6_server.py ###

# For options please consult the following website:
# https://www.isc.org/wp-content/uploads/2017/08/dhcp43options.html

log-facility local7;
{% if preference is vyos_defined %}
option dhcp6.preference {{ preference }};
{% endif %}

{% if global_parameters.name_server is vyos_defined %}
option dhcp6.name-servers {{ global_parameters.name_server | join(', ') }};
{% endif %}

# Vendor specific options - Cisco
option space cisco code width 2 length width 2;
option cisco.tftp-servers code 1 = array of ip6-address;
option vsio.cisco code 9 = encapsulate cisco;

{% if sub_delegation is vyos_defined %}
include "/run/dhcp-server/dhcpdv6_sd.conf";
{% endif %}

# Shared network configration(s)
{% if shared_network_name is vyos_defined %}
{%     for network, network_config in shared_network_name.items() if network_config.disable is not vyos_defined %}
shared-network {{ network }} {
{%         if network_config.common_options is vyos_defined %}
{%             if network_config.common_options.info_refresh_time is vyos_defined %}
    option dhcp6.info-refresh-time {{ network_config.common_options.info_refresh_time }};
{%             endif %}
{%             if network_config.common_options.domain_search is vyos_defined %}
    option dhcp6.domain-search "{{ network_config.common_options.domain_search | join('", "') }}";
{%             endif %}
{%             if network_config.common_options.name_server is vyos_defined %}
    option dhcp6.name-servers {{ network_config.common_options.name_server | join(', ') }};
{%             endif %}
{%         endif %}
{%         if network_config.subnet is vyos_defined %}
{%             for subnet, subnet_config in network_config.subnet.items() %}
    subnet6 {{ subnet }} {
{%                 if subnet_config.address_range is vyos_defined %}
{%                     if subnet_config.address_range.prefix is vyos_defined %}
{%                         for prefix, prefix_config in subnet_config.address_range.prefix.items() %}
        range6 {{ prefix }} {{ "temporary" if prefix_config.temporary is vyos_defined }};
{%                         endfor %}
{%                     endif %}
{%                     if subnet_config.address_range.start is vyos_defined %}
{%                         for address, address_config in subnet_config.address_range.start.items() %}
        range6 {{ address }} {{ address_config.stop }};
{%                         endfor %}
{%                     endif %}
{%                 endif %}
{%                 if subnet_config.domain_search is vyos_defined %}
        option dhcp6.domain-search "{{ subnet_config.domain_search | join('", "') }}";
{%                 endif %}
{%                 if subnet_config.lease_time is vyos_defined %}
{%                     if subnet_config.lease_time.default is vyos_defined %}
        default-lease-time {{ subnet_config.lease_time.default }};
{%                     endif %}
{%                     if subnet_config.lease_time.maximum is vyos_defined %}
        max-lease-time {{ subnet_config.lease_time.maximum }};
{%                     endif %}
{%                     if subnet_config.lease_time.minimum is vyos_defined %}
        min-lease-time {{ subnet_config.lease_time.minimum }};
{%                     endif %}
{%                 endif %}
{%                 if subnet_config.name_server is vyos_defined %}
        option dhcp6.name-servers {{ subnet_config.name_server | join(', ') }};
{%                 endif %}
{%                 if subnet_config.nis_domain is vyos_defined %}
        option dhcp6.nis-domain-name "{{ subnet_config.nis_domain }}";
{%                 endif %}
{%                 if subnet_config.nis_server is vyos_defined %}
        option dhcp6.nis-servers {{ subnet_config.nis_server | join(', ') }};
{%                 endif %}
{%                 if subnet_config.nisplus_domain is vyos_defined %}
        option dhcp6.nisp-domain-name "{{ subnet_config.nisplus_domain }}";
{%                 endif %}
{%                 if subnet_config.nisplus_server is vyos_defined %}
        option dhcp6.nisp-servers {{ subnet_config.nisplus_server | join(', ') }};
{%                 endif %}
{%                 if subnet_config.sip_server is vyos_defined %}
{%                     set server_ip = [] %}
{%                     set server_fqdn = [] %}
{%                     for address in subnet_config.sip_server %}
{%                         if address | is_ipv6 %}
{%                             set server_ip = server_ip.append(address) %}
{%                         else %}
{%                             set server_fqdn = server_fqdn.append(address) %}
{%                         endif %}
{%                     endfor %}
{%                     if server_ip is vyos_defined and server_ip | length > 0 %}
        option dhcp6.sip-servers-addresses {{ server_ip | join(', ') }};
{%                     endif %}
{%                     if server_fqdn is vyos_defined and server_fqdn | length > 0 %}
        option dhcp6.sip-servers-names "{{ server_fqdn | join('", "') }}";
{%                     endif %}
{%                 endif %}
{%                 if subnet_config.sntp_server is vyos_defined %}
        option dhcp6.sntp-servers {{ subnet_config.sntp_server | join(', ') }};
{%                 endif %}
{%                 if subnet_config.prefix_delegation.start is vyos_defined %}
{%                     for prefix, prefix_config in subnet_config.prefix_delegation.start.items() %}
        prefix6 {{ prefix }} {{ prefix_config.stop }} /{{ prefix_config.prefix_length }};
{%                     endfor %}
{%                 endif %}
{%                 if subnet_config.static_mapping is vyos_defined %}

        # begin configuration of static client mappings
{%                     for host, host_config in subnet_config.static_mapping.items() if host_config.disable is not vyos_defined %}
        host {{ network | replace('_','-') }}_{{ host | replace('_','-') }} {
{%                         if host_config.identifier is vyos_defined %}
            host-identifier option dhcp6.client-id {{ host_config.identifier }};
{%                         endif %}
{%                         if host_config.ipv6_address is vyos_defined %}
            fixed-address6 {{ host_config.ipv6_address }};
{%                         endif %}
{%                         if host_config.ipv6_prefix is vyos_defined %}
            fixed-prefix6 {{ host_config.ipv6_prefix }};
{%                         endif %}
        }
{%                     endfor %}
{%                 endif %}
{%                 if subnet_config.vendor_option.cisco.tftp_server is vyos_defined %}
        option cisco.tftp-servers {{ subnet_config.vendor_option.cisco.tftp_server | join(', ') }};
{%                 endif %}
    }
{%             endfor %}
{%         endif %}
    on commit {
        set shared-networkname = "{{ network }}";
    }
}
{%     endfor %}
{% endif %}
